<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Scraper - Agentic Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/scraper.js" defer></script>
</head>

<body class="bg-gray-100">
    <nav class="bg-white shadow-lg">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between">
                <div class="flex space-x-7">
                    <a href="/" class="flex items-center py-4">
                        <span class="font-semibold text-gray-500 text-lg">Agentic Intelligence</span>
                    </a>
                </div>
                <div class="flex items-center space-x-3">
                    <span id="username" class="text-gray-500"></span>
                    <button onclick="logout()"
                        class="py-2 px-4 bg-red-500 text-white rounded hover:bg-red-600">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- Scraper Control Panel -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-2xl font-bold mb-6">Data Scraper</h1>

            <!-- Configuration -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4">Configuration</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="totalProducts" class="block text-sm font-medium text-gray-700 mb-2">
                            Total Products to Scrape
                        </label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <input type="number" id="totalProducts" name="totalProducts"
                                class="block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                                placeholder="100" value="100" min="2" max="200">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm">products</span>
                            </div>
                        </div>
                        <p class="mt-2 text-sm text-gray-500">
                            Products will be evenly distributed between sources
                        </p>
                    </div>
                    <div>
                        <label for="headlessMode" class="block text-sm font-medium text-gray-700 mb-2">
                            Browser Mode
                        </label>
                        <select id="headlessMode" name="headlessMode"
                            class="block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                            <option value="true">Headless (Faster)</option>
                            <option value="false">Visible (Debug)</option>
                        </select>
                        <p class="mt-2 text-sm text-gray-500">
                            Headless mode runs in background, visible mode shows browser
                        </p>
                    </div>
                </div>
            </div>

            <!-- Control Buttons -->
            <div class="flex gap-4">
                <button id="startScraper"
                    class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Start Scraping
                </button>
                <button id="stopScraper" disabled
                    class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 opacity-50 cursor-not-allowed">
                    Stop Scraping
                </button>
            </div>
        </div>

        <!-- Progress Section -->
        <div id="progressSection" class="hidden mt-6 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Scraping Progress</h2>

            <!-- Overall Progress -->
            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <span class="text-sm font-medium text-gray-700">Overall Progress</span>
                    <span id="progressPercentage" class="text-sm font-medium text-blue-600">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300"
                        style="width: 0%"></div>
                </div>
            </div>

            <!-- Source Progress -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Breakout Progress</h3>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="breakoutProgress" class="bg-green-500 h-2 rounded-full transition-all duration-300"
                            style="width: 0%"></div>
                    </div>
                    <p id="breakoutStatus" class="mt-2 text-sm text-gray-600">Waiting to start...</p>
                </div>
                <div>
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Rastah Progress</h3>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="rastahProgress" class="bg-green-500 h-2 rounded-full transition-all duration-300"
                            style="width: 0%"></div>
                    </div>
                    <p id="rastahStatus" class="mt-2 text-sm text-gray-600">Waiting to start...</p>
                </div>
            </div>

            <!-- Status Messages -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h3 class="text-sm font-medium text-gray-700 mb-2">Status Updates</h3>
                <div id="statusMessages" class="space-y-2 max-h-40 overflow-y-auto text-sm">
                    <!-- Status messages will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden mt-6 bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Scraped Data</h2>
                <button id="downloadData"
                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Download Data
                </button>
            </div>

            <!-- Results Summary -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-sm font-medium text-gray-700">Total Products</h3>
                    <p id="totalScraped" class="mt-2 text-2xl font-semibold text-blue-600">0</p>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-sm font-medium text-gray-700">Breakout Products</h3>
                    <p id="breakoutCount" class="mt-2 text-2xl font-semibold text-green-600">0</p>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-sm font-medium text-gray-700">Rastah Products</h3>
                    <p id="rastahCount" class="mt-2 text-2xl font-semibold text-green-600">0</p>
                </div>
            </div>

            <!-- Data Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Product
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Price
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Description
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Source
                            </th>
                        </tr>
                    </thead>
                    <tbody id="scrapedDataTable" class="bg-white divide-y divide-gray-200">
                        <!-- Table rows will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Error Section -->
        <div id="errorSection" class="hidden mt-6">
            <div class="bg-red-50 border-l-4 border-red-400 p-4">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">Error</h3>
                        <p id="errorMessage" class="mt-2 text-sm text-red-700"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>